<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<title>Home Page</title>
		<link
			rel="stylesheet"
			type="text/css"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
		/>
		<script src="http://localhost:35729/livereload.js"></script>
	</head>
	<body>
		<div th:replace="~{fragments :: navbar}"></div>

		<section class="pb-3 pt-5 text-center">
			<h1>Log In</h1>
		</section>

		<section class="px-5 pb-3 text-center d-flex justify-content-center">
			<form action="/login" method="post" class="w-50" id="logInForm">
				<div class="mb-3 text-start">
					<label for="emailForLogin" class="form-label">Email</label>
					<input
						type="email"
						class="form-control"
						id="emailForLogin"
						name="email"
						required
					/>
				</div>
				<div class="mb-3 text-start">
					<label for="passwordForLogin" class="form-label">Password</label>
					<input
						type="password"
						class="form-control"
						id="passwordForLogin"
						name="password"
						required
					/>
				</div>
				<button type="submit" class="btn btn-primary">Submit</button>
			</form>
			<script>
				const form = document.getElementById("logInForm");
				form.addEventListener("submit", (e) => {
					e.preventDefault();
					document.getElementById("status").textContent = "";
					const email = document.getElementById("emailForLogin").value;
					const pw = document.getElementById("passwordForLogin").value;

					const emailPass = `${email}:${pw}`;
					const base64encoding = btoa(emailPass);
					console.log(`Encoding is ${base64encoding}`);

					fetch("/login", {
						method: "POST",
						headers: {
							Authorization: `Basic ${base64encoding}`,
						},
						redirect: "follow",
					}).then((res) => {
						if (res.ok) {
							document.getElementById("status").textContent = "Log in succeeded";
						} else if (res.status == 401) {
							document.getElementById("status").textContent = "Log in failed (Unauthorized!)";
						} else {
							document.getElementById("status").textContent = "Log in failed (Unknown reason!)";
						}
					});
				});
			</script>
		</section>

		<section class="pb-3 pt-5 text-center">
			<h1>Log in Status</h1>
			<p id="status"></p>
		</section>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
